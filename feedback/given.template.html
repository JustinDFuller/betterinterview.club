<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Better Interviews | Feedback Given</title>
    <style>
      {{ template "index.css" }}
    </style>
  </head>
  <body>
    <header>
      <h1>Feedback Given</h1>
      <nav>
        <a href="/organization/">My Organization</a>
        <a href="/auth/logout/">Log Out</a>
      </nav>
    </header>

    <h2>{{ .Team }} - {{ .Role }}</h2> 
    <form action="/feedback/give/{{ .ID }}" method="post">
      {{ $email := UserEmail .CreatorID }}
      <p>
        Requested By: {{ $email }}
      </p>
      <p>
        On: {{ .CreatedAt.Format "January 2 2006" }}
      </p>


      {{ $questions := .Questions }}

      {{ range .Requests }}
        {{ $responses := .Responses }}
        <hr />
        <strong>Candidate:</strong> {{ .CandidateName }}
        {{ if len .Responses }}
          <div class="table-container" style="margin-top: 16px;">
            <table>
              <tbody>
                <tr>
                  <th>
                    Submitted By 
                  </th>
                  {{ range .Responses }}
                    <td>
                      {{ $email := UserEmail .CreatorID }}
                      {{ $email }}
                    </td>
                  {{ end }}
                </tr> 
                <tr>
                  <th>
                    Submitted On 
                  </th>
                  {{ range .Responses }}
                    <td>
                      {{ .CreatedAt.Format "January 2 2006" }}
                    </td>
                  {{ end }}
                </tr>
                  {{ range $questions }} 
                    <tr>
                      <th>
                        {{ .Text }} 
                      </th> 
                      {{ $questionID := .ID }}
                      {{ range $responses }}
                        {{ range .Answers }}
                          {{ if eq .QuestionID $questionID }}
                            <td>
                              {{ if .Response }}  Yes {{ else }} No {{ end }}
                            </td>
                          {{ end }}
                        {{ end }}
                      {{ end }}
                    </tr>
                  {{ end }}
                <tr>
                  <th>
                    Do you recommend this candidate for this position?
                  </th>
                  {{ range .Responses }}
                    <td>
                      {{ if .Recommend }}
                        Yes
                      {{ else }}
                        No
                      {{ end }}
                    </td>
                  {{ end }}
                </tr> 
              </tbody>
            </table>
          </div>
          {{ if len .Responses 1 }}
            <p>
              Still waiting on feedback from 
              {{ range .InterviewerEmails }}  
                {{ $email := . }}
                {{ $found := false }} 
                {{ range $responses }}
                  {{ $email2 := UserEmail .CreatorID }}
                  {{ if eq $email $email2 }}
                    {{ $found = true }}
                  {{ end }}
                {{ end }}
                {{ if not $found }}
                  <a href="{{ . }}">{{ . }}</a>
                {{ end }}
              {{ end }}
            </p>
          {{ end }}
        {{ else }}
          <p>
            This candidate has not received feedback yet.
          </p>
          <p>
           Waiting on feedback from:
          </p>
          <ul>
            {{ range .InterviewerEmails }} 
            <li><a href="mailto:{{ . }}">{{ . }}</a></li>
            {{ end }}
          </ul>
        {{ end }}
      {{ else }}
        <hr />
        <strong>Candidate:</strong> {{ .CandidateName }}
        <p>
          This role has not requested feedback yet.
        </p>
      {{ end }}
    </form>
  </body>
</html>
